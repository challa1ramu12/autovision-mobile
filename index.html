<script>
const SUPABASE_URL = "https://qobnvvhefcxxarchdxsh.supabase.co";
const SUPABASE_KEY = "sb_publishable_UUsw6Eg8stkb543Mbtqv5A_Xd7VDxzX";

async function submitData(){

 const vendor = document.getElementById("vendor").value;
 const amount = document.getElementById("amount").value;
 const photo = document.getElementById("photo").files[0];

 if(!vendor || !amount){
   alert("Fill vendor & amount");
   return;
 }

 let billUrl = null;

 try {

 if(photo){
   const fileName = Date.now()+"_"+photo.name;

   const upload = await fetch(
     SUPABASE_URL + "/storage/v1/object/bills/" + fileName,
     {
       method:"POST",
       headers:{
         "apikey":SUPABASE_KEY,
         "Authorization":"Bearer "+SUPABASE_KEY,
         "Content-Type": photo.type
       },
       body: photo
     }
   );

   if(!upload.ok){
     alert("Photo upload failed");
     return;
   }

   billUrl = SUPABASE_URL + "/storage/v1/object/public/bills/" + fileName;
 }

 const inv = await fetch(SUPABASE_URL+"/rest/v1/invoices",{
   method:"POST",
   headers:{
     "apikey":SUPABASE_KEY,
     "Authorization":"Bearer "+SUPABASE_KEY,
     "Content-Type":"application/json",
     "Prefer":"return=representation"
   },
   body:JSON.stringify({
     vendor_name:vendor,
     amount:amount,
     bill_url: billUrl,
     pushed_to_tally:false
   })
 });

 const txt = await inv.text();

 if(!inv.ok){
   alert("Invoice insert failed: " + txt);
   return;
 }

 document.getElementById("msg").innerHTML="Saved âœ”<br>"+txt;

 } catch(e){
   alert(e.message);
 }

}
</script>
