<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>AutoVision Entry</title>
</head>

<body style="font-family:Arial;padding:20px">

<h2>New Expense</h2>

<input id="vendor" placeholder="Vendor Name" style="width:100%;padding:10px"><br><br>

<input id="amount" type="number" placeholder="Amount" style="width:100%;padding:10px"><br><br>

<input id="photo" type="file" accept="image/*" style="width:100%;padding:10px"><br><br>

<button onclick="submitData()" style="width:100%;padding:15px;background:green;color:white">
Submit
</button>

<p id="msg"></p>

<script>
const SUPABASE_URL = "https://qobnvvhefcxxarchdxsh.supabase.co";
const SUPABASE_KEY = "sb_publishable_UUsw6Eg8stkb543Mbtqv5A_Xd7VDxzX";

async function submitData(){

 const vendor = document.getElementById("vendor").value;
 const amount = document.getElementById("amount").value;
 const photo = document.getElementById("photo").files[0];

 if(!vendor || !amount){
   alert("Fill vendor & amount");
   return;
 }

 let billUrl = null;

 // Upload photo if selected
 if(photo){
   const fileName = Date.now()+"_"+photo.name;

   const upload = await fetch(
     SUPABASE_URL + "/storage/v1/object/bills/" + fileName,
     {
       method:"POST",
       headers:{
         "apikey":SUPABASE_KEY,
         "Authorization":"Bearer "+SUPABASE_KEY,
         "Content-Type": photo.type
       },
       body: photo
     }
   );

   billUrl = SUPABASE_URL + "/storage/v1/object/public/bills/" + fileName;
 }

 // Insert invoice
 await fetch(SUPABASE_URL+"/rest/v1/invoices",{
   method:"POST",
   headers:{
     "apikey":SUPABASE_KEY,
     "Authorization":"Bearer "+SUPABASE_KEY,
     "Content-Type":"application/json"
   },
   body:JSON.stringify({
     vendor_name:vendor,
     amount:amount,
     bill_url: billUrl,
     pushed_to_tally:false
   })
 });

 document.getElementById("msg").innerHTML="Saved âœ”";

}
</script>

</body>
</html>
